---
title: "Mini R Project 2"
author: "Natalia Iannucci and Sunni Raleigh"
output: html_document
---

##loading the dataset
```{r}
data <- read.table("Shortleaf.txt", header = T, sep = '\t')

attach(data)

```



##Initial study to observe the nature of the relationship between the volume of shortleaf pines and their diameters 

__Graphical Method:__ Scatter Plot
```{r}
plot(Diameter, Volume, pch = 19, cex = 1.5, col = "blue", main = "Scatter plot between volume and diamater of shortleaf pines")
```
The scatterplot shows a positive trend, however; it appears to be slightly non-linear.

__Numerical Method:__ Pearson Linear Correlation Coefficient 
```{r}
r <- cor(Diameter, Volume)
r
```
The r value of 0.9447509 suggests that there is a strong positive linear correlation between tree diameter and volume.

__Based on the scatter plot and the r value, fitting a linear relationship is reasonable.__ 

##Fit a least square regression line to predict the volume based on the diameter.
```{r}
regModel <- lm(Diameter ~ Volume)
regModel
```

$y_i = 6.6285 +0.1306x_i + e_i$ for $i=1,2,\cdots,70$ where y is the tree volume, x is the tree diameter, and e is the random error with the assumptions $e_i \stackrel{iid}\sim N(0, \sigma^2)$.

```{r}
plot(Diameter, Volume, pch = 16, main = "Fitted Regression Line")
abline(regModel, col= "blue", lwd = 2)

```

##Check linearity and constant variance conditions:
```{r}
# find residuals
residuals <- resid(regModel)
residuals

# find predicted values
predValues <- predict(regModel)
predValues

# plot the predicted values against the residuals
plot(predValues, residuals)
abline(0,0, col="red")
```
The condition of constant variance and linearity are not met, as the variance fans out and the scatterplot of residuals shows a clear nonlinear trend. This suggests that we need to perform a transformation.

##Check normality of residuals
```{r}
hist(residuals)
qqnorm(residuals, pch = 19, col= "blue")
qqline(residuals, col="red")

m <- mean(residuals)
m
# the zero mean condition holds.
```
While the mean of the residuals is very close to 0 and and the zero mean condition holds, the histogram of residuals appears to be left-skewed, and the points on the normal Q-Q plot are not linear. Therefore, the normaility condition is also violated, suggesting that we need a trasformation. 

## Remedial Measures
```{r}
sqrt_Y = sqrt(Volume)
r = cor(sqrt_Y, Diameter)
r

plot(Diameter, sqrt_Y, pch = 16, ylab = "Volume", xlab = "Diamater", main = "scatter plot between volume and diamater")
```
The scatterplot drawn between the transformed Y and X reflects a linear relationship, with a r value of 0.987 suggesting a strong linear relationship between sqrt(Y) and X modeled by the following:

```{r}
newRegModel <- lm(sqrt_Y~Diameter)
newRegModel
```
$sqrt(y_i) = -1.1366 + 0.5832x_i + e_i$ for $i=1,2,\cdots,70$ where y is the tree volume, x is the tree diameter, and e is the random error with the assumptions $e_i \stackrel{iid}\sim N(0, \sigma^2)$.

## Plot new model
```{r}
plot(Diameter, sqrt_Y, pch = 16, main = "Fitted Regression Line")
abline(newRegModel, col= "blue", lwd = 2)
```

##Check linearity and constant variance conditions of new model:
```{r}
# find residuals
newResiduals <- resid(newRegModel)
newResiduals

# find predicted values
newPredValues <- predict(newRegModel)
newPredValues

# plot the predicted values against the residuals
plot(newPredValues, newResiduals)
abline(0,0, col="red")
```
While better than the first model, the variance of the residuals is still not constant. There does appear to be a slight linear trend. We could perform another transformation.


## Check normality of new residual values:
```{r}
hist(newResiduals)
qqnorm(newResiduals, pch = 19, col= "blue")
qqline(newResiduals, col="red")

m <- mean(newResiduals)
m
```
The distribution of the new residuals, while better than the first model, is still skewed left. Most of the points on the Q-Q line are linear but then stray as the theoretical quantities move more negative and more positive. Mean zero condition is met as the mean of the residuals is very close to 0. We could perform another tranformation to create a stronger model between the variables.
